---
- name: Loading python and after the Kubernetes library // infra/ansible/playbook/packages/plugin-k8s/install.yaml
  hosts:
    - dev
    - test
    - prod
  become: true
  tasks:
    - name: Install Python
      ansible.builtin.dnf:
        name: python3
        state: latest

    - name: Install pip
      ansible.builtin.dnf:
        name: python3-pip
        state: latest

    - name: Install Python Kubernetes library
      ansible.builtin.pip:
        name: kubernetes
        executable: /usr/bin/pip3.9
        state: present

    - name: Upgrade oauthlib for kubernetes compatibility
      ansible.builtin.pip:
        name: "oauthlib>=3.2.0"
        executable: /usr/bin/pip3.9
        state: present
        break_system_packages: true
