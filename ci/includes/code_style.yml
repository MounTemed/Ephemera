# ansible
ansible-lint:
  stage: lint
  image:
    name: registry.gitlab.com/pipeline-components/ansible-lint:latest
  script:
    - ansible-lint ./infra/ansible/playbook/ --strict --nocolor --parseable

yamllint:
  stage: lint
  image:
    name: registry.gitlab.com/pipeline-components/yamllint:latest
  script:
    - yamllint --strict --format colored ./infra/ansible/playbook/

# terraform
terraform-fmt:
  stage: lint
  image:
    name: docker.io/hashicorp/terraform:latest
  script:
    - terraform fmt -check -diff ./infra/terraform/

tf-lint:
  stage: lint
  image:
    name: ghcr.io/terraform-linters/tflint
  script:
    - cd ./infra/terraform/ && tflint --init && tflint --format=checkstyle

# kubernetes
kubeconfrom:
  stage: lint
  image:
    name: ghcr.io/yannh/kubeconform:latest
    entrypoint: [""]
  script:
    - kubeconform -summary -exit-on-error ./kubernetes/

# helm
helm-lint:
  stage: lint
  image:
    name: docker.io/alpine/helm:latest
  script:
    - helm lint ./kubernetes/* --debug

# gitlab
gitlab-lint:
  stage: lint
  script:
    - |
      set -e
      for file in $(find ./repository -type -f -name "*.yml"); do
        gitlab-ci-lint validate --file "$file"
      done
